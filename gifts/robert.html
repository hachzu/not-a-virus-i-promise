<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Robbie</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Darker Grotesque:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --main-text: #d3bb51;
      --glow: rgb(218, 204, 127);

      --button-border: #c79409;
      --button-text: rgb(221, 173, 15);
      --button-glow: rgba(240, 199, 16, 0.753);
      --button-bg: rgba(2, 6, 23, 0.45);

      --skip-border: rgba(255, 217, 0, 0.233);
      --skip-bg: rgba(236, 240, 16, 0);
      --skip-text: #ddb01b;

      --bg-brightness: 0.40;
      --bg-blur: 13px;

      --img-shadow: rgba(173, 150, 71, 0.747);
      --font-size: 2.0rem;
    }

    .special-word {
    color: #ff0000; 
    text-shadow: 0 0 12px #ff0000; 
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      font-family: "Darker Grotesque", cursive;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      color: var(--main-text);
    }

    .bg {
      position: fixed;
      top: -40px;
      left: -40px;
      right: -40px;
      bottom: -40px;
      background: url('robertbg.png') center / cover no-repeat fixed;
      filter: blur(var(--bg-blur)) brightness(var(--bg-brightness));
      z-index: -1;
      will-change: transform;
      transition: transform 0.15s ease-out;
    }

    .start-btn {
      position: fixed;
      inset: 0;
      margin: auto;
      width: fit-content;
      height: fit-content;
      padding: 14px 36px;
      border-radius: 999px;
      border: 1px solid var(--button-border);
      background: var(--button-bg);
      color: var(--button-text);
      font-size: 1.1rem;
      cursor: pointer;
      backdrop-filter: blur(8px);
      transition: transform 0.4s ease, box-shadow 0.4s ease, opacity 0.6s ease;
    }

    .start-btn:hover {
      transform: scale(1.06);
      box-shadow: 0 0 25px var(--button-glow);
    }

    .start-btn.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .text {
      position: relative;
      padding: 8vh 10vw;
      font-size: var(--font-size);
      line-height: 1.9;
      white-space: pre-wrap;
      text-shadow: 0 0 16px var(--glow);
    }

    .char {
      opacity: 0;
      animation: fadeChar 0.4s ease forwards;
    }

    @keyframes fadeChar {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .skip-btn {
      position: fixed;
      top: 18px;
      right: 18px;
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid var(--skip-border);
      background: var(--skip-bg);
      color: var(--skip-text);
      font-size: 0.8rem;
      backdrop-filter: blur(6px);
      cursor: pointer;
      transition: transform 0.18s ease, opacity 0.18s ease;
      opacity: 0;
      pointer-events: none;
    }

    .skip-btn.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .skip-btn:hover { transform: translateY(-2px); }
    
    .inserted-img {
      display: block;
      margin: 18px auto;
      max-width: 92%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 6px 24px var(--img-shadow);
      opacity: 0;
      transition: opacity 360ms ease, transform 360ms ease;
      transform: translateY(6px);
    }

    .inserted-img.visible { opacity: 1; transform: translateY(0); }
  </style>
</head>
<body>

  <div class="bg"></div>

  <div class="text" id="text"></div>
  <button class="start-btn" id="startBtn">...</button>
  <button class="skip-btn" id="skipBtn" aria-label="Skip typing">Skip (may cause issues!)</button>

  <script>
    const startBtn = document.getElementById("startBtn");
    const textEl = document.getElementById("text");
    const bg = document.querySelector('.bg');

    let textNode = document.createTextNode('');
    textEl.appendChild(textNode);

    let skipRequested = false;
    const skipBtn = document.getElementById('skipBtn');

    function skipTyping() {
  if (audioCtx && typeof audioCtx.close === 'function') audioCtx.close().catch(()=>{});
  audioCtx = null;
  skipRequested = true;

  // clear everything
  textEl.innerHTML = '';

  // split by newlines to preserve them
  const lines = letter.split('\n');

  lines.forEach(line => {
    // check for image insertion
    const imgMatch = line.match(/\[\[IMG:([^\|\]]+)(?:\|([^\|\]]*))?(?:\|([^\|\]]*))?(?:\|([^\]]*))?\]\]/);
    if (imgMatch) {
      const [full, src, w, h, alt] = imgMatch;
      const img = document.createElement('img');
      img.className = 'inserted-img';
      img.src = src.trim();
      if (w && w.trim()) img.style.width = w.trim();
      if (h && h.trim()) img.style.height = h.trim();
      img.alt = alt?.trim() || '';
      textEl.appendChild(img);
      setTimeout(() => img.classList.add('visible'), 50);

      // remove the image code from the line
      line = line.replace(full, '');
    }

    // append the remaining text as a text node
    if (line.length > 0) {
      const textNode = document.createTextNode(line);
      textEl.appendChild(textNode);
    }

    // add a newline (preserved by pre-wrap)
    textEl.appendChild(document.createElement('br'));
  });

  window.scrollTo(0, document.body.scrollHeight);
  if (skipBtn) skipBtn.classList.remove('visible');
}


    if (skipBtn) skipBtn.addEventListener('click', skipTyping);

    const SPEEDS = { normal: 35, slow: 60 };

    let audioCtx = null;
    function ensureAudio() {
      if (audioCtx) return audioCtx;
      try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch (e) { audioCtx = null; }
      return audioCtx;
    }

    function playTick(ch) {
      const ctx = audioCtx;
      if (!ctx) return;
      if (/\s/.test(ch) && ch !== '\n') return;
      const now = ctx.currentTime;
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      let freq = 180 + Math.random() * 80;
      if (/[.,:;!?]/.test(ch)) freq = 200 + Math.random() * 60;
      if (/\n/.test(ch)) freq = 160;
      o.type = 'sine';
      o.frequency.setValueAtTime(freq, now);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.linearRampToValueAtTime(0.10, now + 0.006);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);
      o.connect(g); g.connect(ctx.destination);
      o.start(now); o.stop(now + 0.14);
    }

    const letter = `
hi rob, you just clicked on a link that can give me access to your computer, {{special}}and will probably retrieve your passwords and be sent to me.{{/special}}

just kidding lol. well anyways,

happy new year, robert!! and while i know this is one of those niche letters i barely do, i still wanted to make this for you, because you are my genuine friend and i appreciate you a lot since we've been friends.

[[IMG:robertdon.png|150|150|Robert peak]]

you are probably enjoying canto 9 right now, so i hope you are having a great time with it. idk, you probably finished it by now üò≠ get a life twin (jk).

but yeah, thank you for being such a great friend to me, for all the libres and free food you have given us, and for letting us crash at your parent‚Äôs office. that was peak. i notice and appreciate everything you have done for me and the others, and i hope you know that. every small thing you do, whether it is sharing something or just being around, adds so much to our group, and i want you to see that your efforts never go unnoticed.

you are a great person, robert, and i hope you always remember that. you deserve all the good things in life, and i hope you get every single one of them. your kindness, your patience, and even the random chaotic energy you bring is something rare and special. honestly, i am really glad i met you, and sometimes i still think about how funny it is that it all started because i accidentally greeted you a happy birthday thinking you were someone else. that tiny mix-up somehow turned into one of the best friendships i could have asked for, and i am so thankful for it.

this year was truly something else, with all the deadlines, academics, and drama we had to go through. damn bro, i could not have made it without all of you, especially with the new friend groups we formed, public quest and coco‚Äôs harem. all the chaos, the laughs, the small victories, the random moments we barely notice at the time, they all added up to something really memorable. you being there for all of that made a huge difference.

thank you for treating me like a good friend. i am genuinely grateful that i have met you and everyone else in our circle. y‚Äôall are special to me, really, and i hope you feel that. i hope that next year we can create even more ridiculous memories, finish even more tasks, and still find time to just hang out and have fun without worrying about anything else.

i manifest 2026 to be a great year for you. i hope it brings good times with maegan, peace and happiness with your parents, and that all the things you have been struggling with finally turn out well. i hope it gives you more laughs than stress, more chill moments than chaos, and all the small little things that make life feel really good.

[[IMG:robgroup.jpg|150|150|trio!]]

hello... hello?? {{special}} goodbye. {{/special}}

- ÊÑõ„ÇíËæº„ÇÅ„Å¶, Lance <3
`;

    const rawText = letter.split('\n\n').map(p => ({ text: p + '\n\n', speed: 'normal' }));
    if (rawText[0]) rawText[0].speed = 'slow';


let special = false;

function typeWriter(arr, index = 0, charIndex = 0) {
  if (skipRequested) return;
  if (index >= arr.length) {
    if (skipBtn) skipBtn.classList.remove('visible');
    return;
  }

  const part = arr[index];

  if (charIndex < part.text.length) {
    let remaining = part.text.slice(charIndex);

    // Handle image tags first
    if (remaining.startsWith('[[IMG:')) {
      const imgMatch = remaining.match(/^\[\[IMG:([^\|\]]+)(?:\|([^\|\]]*))?(?:\|([^\|\]]*))?(?:\|([^\]]*))?\]\]/);
      if (imgMatch) {
        const [full, src, w, h, alt] = imgMatch;
        const img = document.createElement('img');
        img.className = 'inserted-img';
        img.src = src.trim();
        if (w && w.trim()) img.style.width = w.trim();
        if (h && h.trim()) img.style.height = h.trim();
        img.alt = alt?.trim() || '';
        textEl.appendChild(img);
        setTimeout(() => img.classList.add('visible'), 50);

        // skip the image tag in text
        charIndex += full.length;
        setTimeout(() => typeWriter(arr, index, charIndex), 50);
        return;
      }
    }

    // Handle opening special tag
    if (remaining.startsWith('{{special}}')) {
      special = true;
      charIndex += '{{special}}'.length; // skip marker completely
      remaining = part.text.slice(charIndex);
    }

    // Handle closing special tag
    if (remaining.startsWith('{{/special}}')) {
      special = false;
      charIndex += '{{/special}}'.length; // skip marker completely
      remaining = part.text.slice(charIndex);
    }

    // Check if we're past the end of the part after skipping tags
    if (charIndex >= part.text.length) {
      setTimeout(() => typeWriter(arr, index + 1, 0), 400);
      return;
    }

    // Type character
    const ch = part.text.charAt(charIndex);
    const span = document.createElement('span');
    span.className = 'char';
    if (special) span.classList.add('special-word'); 
    span.textContent = ch;
    textEl.appendChild(span);

    playTick(ch);
    window.scrollTo(0, document.body.scrollHeight);

    let delay = SPEEDS[part.speed];
    if (ch === '.') delay += 850;
    else if (ch === '?' || ch === '!') delay += 400;
    else if (ch === ',' || ch === ';' || ch === ':') delay += 400;

    setTimeout(() => typeWriter(arr, index, charIndex + 1), delay);
  } else {
    setTimeout(() => typeWriter(arr, index + 1, 0), 400);
  }
}


    startBtn.addEventListener("click", async () => {
      startBtn.classList.add("hidden");
      if (skipBtn) skipBtn.classList.add('visible');
      const ctx = ensureAudio();
      if (ctx && ctx.state === 'suspended') await ctx.resume();
      typeWriter(rawText);
    });

    document.addEventListener('mousemove', e => {
      const x = (e.clientX / window.innerWidth - 0.5) * 35;
      const y = (e.clientY / window.innerHeight - 0.5) * 35;
      bg.style.transform = `translate(${x}px, ${y}px)`;
    });

  </script>

</body>
</html>
